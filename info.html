<html>
<head>
	<title>Информация о юзере</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<link rel="stylesheet" type="text/css" href="css/bootstrap.css">
	<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
	<link rel="stylesheet" type="text/css" href="css/statusBar.css">

  	<script src="//code.jquery.com/jquery-1.10.2.js"></script>
  	<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
  	<script type="text/javascript" src="js/custom.js"></script>

  	<style type="text/css">
  		#info div{
  			border-radius: 10px;
  			border: solid 3px black;
  			/*font-size: 30px;*/
  			padding: 15px;
  			width: 300px;
  		}
  		.clickableUser {
  			cursor: pointer;
  		}
  	</style>

</head>
<body>

<div>
	<nav class="navbar navbar-default navbar-top">
		<div class="container-fluid">
			<div class="navbar-header"> 
				<a class="navbar-brand" href="index.html">Главная</a>
			</div>
			<ul class="nav navbar-nav">
				<li id="reg"><a href="registration.html">Регистрация</a></li>
				<li id="nut"><a href="nutrition.html">Питание</a></li>
				<li id="room"><a href="rooms.html">Поселение</a></li>
				<li id="bage"><a href="makebage.html">Сделать Бэйдж</a></li>
				<li id="userInfo"><a href="info.html">Информация о юзере</a></li>
			</ul>
		</div>
	</nav>	
</div>	
<div class="container">
	<div class="col-md-6">
		<form role="form" action="" method="post">

		<div class="form-group"> 						
			<label for="events">Мероприятие:</label>
			<br>
			<div id="events">
				<b>-----</b>
			</div>
		</div>
			<div class="form-group">
				<label for="lfm">ФИО</label>
				<br>
		    	<input id="lfm" class="ui-widget" type="text" class="form-control" name="lfm"/>
		    </div>

		    <!-- <input id="button" type="submit" name="submit" value="Submit" /> -->
			<button id="button" class="btn btn-default" type="button">OK</button>
		</form>
		<div id="info">

		</div>
	</div>
	<div id="displayUsers" class="col-md-6">

	</div>
</div>
<script type="text/javascript">
	var status = localStorage.getItem("status");
	paintBars(status, "userInfo");
	putEvent();

	var fio = "";
	var LFM = new Array();
	var result = {action: "usrinfo", firstname: null, lastname: null, middlename: null, start: null, end: null};
	$(function() {
		$( "#lfm" ).autocomplete({source: LFM}); 

		$("#button").on("click", function() {
			sendData();
		});

		// $( "#event" ).on( "autocompleteselect", function( event, ui ) {
		// 	localStorage.setItem("event", ui.item.value);							
		// });

		if(e = localStorage.getItem("event"))
			$( "#event" ).val(e);
	});


	var url = "handler.php"
	var sendReq = function(params, callback) {
		$.post(url, params, function(data) {
			callback(data);
		});
	}

	var users;
	sendReq({action: "getUsers", event: localStorage.getItem('event')}, function(data){
		if(data[0] == '['){
			//console.log(data);
			users = JSON.parse(data);
			var s = '';
			for(var i in users) {
				var firstname = users[i].first_name;
				var lastname= users[i].last_name;
				var middlename = users[i].middle_name;
				var lfm = lastname+' '+firstname+' '+middlename;
				LFM.push(lfm);
				s += '<b class="clickableUser">' + lastname + ' ' + firstname + ' ' + middlename + '</b>' + '<br>';
			}

			console.log(s);
			$("#displayUsers").html(s);
			$(".clickableUser").on("click", function() {
				var selectedUser = $(this).text();
				console.log(selectedUser);
				$("#lfm").html(selectedUser);
				$("#lfm").val(selectedUser);
				$("#button").click();
			});
			$( "#lfm" ).autocomplete({source: LFM}); 
		}
		else
			alert(data);
	});	


	var sendData = function() {
		fio = $( "#lfm" ).val();
		var res = window.fio;
		var arr = res.split(' ');
		result.lastname = arr[0];
		result.firstname = arr[1];
		result.middlename = arr[2];
		sendReq(result, function(data) {
			if(data[0] != '[')
				alert(data);
			else
			{
				var res = JSON.parse(data);
				printUser(res);
			}
		});
	}


	var printUser = function(res) {
		for(var i in res) {
			console.log(res[i]);
			var user = res[i];
			console.log(user.start);
			var s = '';
			s += '<div>'+'<b>'+user.last_name+' '+user.first_name+' '+user.middle_name+'</b>'+'</br>'+'Возраст: '+user.age+'<br>'
				+'email: '+user.email+'</br>'+'номер:  '+user.mobile_number+'<br>'
				+'въезд: '+user.start+'</br>'
				+'отъезд: '+user.end+'</br>'
				+'комната: '+user.hostel_num+'/'+user.room_num+'</br>'
				+'питание: '+user.nut_start+' / '+user.nut_end+'</br>'
				+'</div>'
			$("#info").html(s);
		}
	}

</script>
</body>
</html>